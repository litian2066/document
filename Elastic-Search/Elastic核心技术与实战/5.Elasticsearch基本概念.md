# Elasticsearch基本概念

## 文档（Document）

![image-20220508173923361](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220508173923361.png)

## JSON文档

![image-20220508174029507](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220508174029507.png)

## 文档的元数据

![image-20220508174119092](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220508174119092.png)

## 索引

![image-20220508174212323](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220508174212323.png)

## 索引的不同语意

![image-20220508174308548](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220508174308548.png)

## TYPE

![image-20220508174344288](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220508174344288.png)

## 抽象与类比

![image-20220508174359266](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220508174359266.png)

## REST API - 很容易被各种语言调用

![image-20220508174511675](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220508174511675.png)

## 一些基本的API

在Kibana里面提供一个管理功能，里面有索引管理

![image-20220508174727859](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220508174727859.png)

点击的时候还可以看到setting、mapping之类的信息

![image-20220508174841045](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220508174841045.png)

接下来使用dev tools来执行一些基本命令

1. 查看索引相关信息`GET movies`

   ![image-20220508175105772](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220508175105772.png)

   

2. 查看indices，支持通配符：`GET /_cat/indices/.kibana*?v&s=index`

   ![image-20220508175256027](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220508175256027.png)

3. 查看每个索引使用的内存`GET /_cat/indices?v&h=i,tm&s=tm:desc`

   ![image-20220508175512954](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220508175512954.png)

## 分布式系统的可用性和扩展性

![image-20220508175808818](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220508175808818.png)

## 分布式特性

![image-20220508175913059](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220508175913059.png)

## 节点

![image-20220508180022120](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220508180022120.png)

## Master-eligible nodes 和 Master Node

![image-20220508180215008](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220508180215008.png)

## Data Node & Coordinating Node

![image-20220508180248105](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220508180248105.png)

## 其他的节点类型

![image-20220508180434007](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220508180434007.png)

## 配置节点类型

> 在Elastic的yaml配置文件中指定节点的角色

![image-20220508180556929](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220508180556929.png)

## 分片（Primary Shard & Replica Shard）

![image-20220508180722699](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220508180722699.png)

下图里面主分片为3，副本分片为1，正好就3个节点，所以一个节点一个主分片，然后每个主分片一个副本分片

![image-20220508181211804](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220508181211804.png)



## 分片的设定

![image-20220508181434645](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220508181434645.png)

## 查看集群的健康状况

![image-20220508181642019](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220508181642019.png)

## 一些常用的命令

> 在mac的环境下 将光标放到命令行，按住command + / 即可跳转到官方文档信息，亲测可用

![image-20220510092744440](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220510092744440.png)

## 使用Cerebro查看集群信息

> 访问localhost:9000查看
>
> 集群默认设置的是1个主分片、1个副本，所以下图中均摊在两个节点上

![image-20220510093428543](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220510093428543.png)

接下来尝试停掉某个节点再来查看集群的信息，使用docker命令

````shell
➜  ~ docker ps
CONTAINER ID   IMAGE                                                 COMMAND                  CREATED        STATUS          PORTS                              NAMES
55da2f831b21   docker.elastic.co/elasticsearch/elasticsearch:7.1.0   "/usr/local/bin/dock…"   25 hours ago   Up 27 minutes   0.0.0.0:9200->9200/tcp, 9300/tcp   es7_01
4974d141b30f   docker.elastic.co/elasticsearch/elasticsearch:7.1.0   "/usr/local/bin/dock…"   25 hours ago   Up 27 minutes   9200/tcp, 9300/tcp                 es7_02
dd464d85a9b8   docker.elastic.co/kibana/kibana:7.1.0                 "/usr/local/bin/kiba…"   25 hours ago   Up 27 minutes   0.0.0.0:5601->5601/tcp             kibana7
df1e8c8260c2   lmenezes/cerebro:0.8.3                                "/opt/cerebro/bin/ce…"   25 hours ago   Up 27 minutes   0.0.0.0:9000->9000/tcp             cerebro
````

```
➜  ~ docker stop 55da2f831b21
```

无论我停掉那个节点，都无法再继续使用kibana或者cerebro，不知道我的设置是否哪儿出错，竟然不能保证集群的可用性，理论上来说，集群健康度应该是黄色才对，还能访问