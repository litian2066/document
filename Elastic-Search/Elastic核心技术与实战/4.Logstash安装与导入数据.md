# Logstash安装与导入数据

1. 下载安装logstash，需要和ES版本保持一致，我这儿下载的是ZIP版本

   https://www.elastic.co/cn/downloads/past-releases/logstash-7-1-0

   ![image-20220508171616661](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220508171616661.png)

2. 解压，然后去[Movielens][https://grouplens.org/datasets/movielens/]下载数据集，我这儿下载的最小的那个

   ![image-20220508171657832](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220508171657832.png)

3. 在bin目录里面编写logstash.conf，内容如下

   > input里面指定对应的数据集路径

   ```conf
   input {
     file {
       path => "/Users/litian/Documents/lian/applications/elastic Statck7.1.0/movielens/ml-latest-small/movies.csv"
       start_position => "beginning"
       sincedb_path => "/dev/null"
     }
   }
   filter {
     csv {
       separator => ","
       columns => ["id","content","genre"]
     }
   
     mutate {
       split => { "genre" => "|" }
       remove_field => ["path", "host","@timestamp","message"]
     }
   
     mutate {
   
       split => ["content", "("]
       add_field => { "title" => "%{[content][0]}"}
       add_field => { "year" => "%{[content][1]}"}
     }
   
     mutate {
       convert => {
         "year" => "integer"
       }
       strip => ["title"]
       remove_field => ["path", "host","@timestamp","message","content"]
     }
   
   }
   output {
      elasticsearch {
        hosts => "http://localhost:9200"
        index => "movies"
        document_id => "%{id}"
      }
     stdout {}
   }
   ```

   

4. 执行命令，将电影数据导入到ES里面（我这儿是在bin目录里面执行的，需要sudo命令）

   **➜** **bin** sudo ./logstash -f logstash.conf 

5. 在kibana的console里面执行`GET _cat/indices`查看所有索引，能看到最新添加的电影索引，也可以在终端中执行`curl localhost:9200/_cat/indices`，也能获得同样的效果

   ![image-20220508173602747](/Users/litian/Documents/lian2077/documents/documents/Elastic-Search/Elastic核心技术与实战/images/image-20220508173602747.png)

