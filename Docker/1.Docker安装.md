## 一、Docker能干什么？

+ 简化配置

  容器最重要的功能，能够实现源代码和运行环境以及配置打包到一个容器里面，这个容器可以运行在不同的环境里

+ 代码流水线管理

+ 提高开发效率

+ 隔离应用

+ 整合服务器

+ 调试能力

+ 多租户

+ 快速部署

## 二、安装Docker

### MAC安装

linux安装比较费劲，我是mac，mac安装比较简单，直接下载dmg文件拖进去就行了。安装方式如下：

如果需要手动下载，请点击以下链接下载 [Stable](https://download.docker.com/mac/stable/Docker.dmg) 或 [Edge](https://download.docker.com/mac/edge/Docker.dmg) 版本的 Docker for Mac。

如同 macOS 其它软件一样，安装也非常简单，双击下载的 .dmg 文件，然后将鲸鱼图标拖拽到 Application 文件夹即可。

从应用中找到 Docker 图标并点击运行。可能会询问 macOS 的登陆密码，输入即可。

启动终端后，通过命令可以检查安装后的 Docker 版本。

````
litiandeMacBook-Pro:~ litian$ docker --version
Docker version 19.03.13, build 4484c46d9d
litiandeMacBook-Pro:~ litian$ 
````

可见我的docker版本是`19.03`的版本，**比较新**

### MAC Docker加速配置

使用国内的docker-hub比较慢，可以去阿里云上面注册一个账号，注册完账号后它上面有一个镜像加速的服务，地址为：https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors

![image-20201214145037163](/Users/litian/Documents/lian2077/documents/documents/Docker/images/1.png)

复制镜像加速地址，因为我的docker版本比较新，添加加速器地址，如下图

![image-20201214145037163](/Users/litian/Documents/lian2077/documents/documents/Docker/images/2.jpg)

添加内容如下，同时附上我的镜像加速地址：

````json
{
  "features": {
    "buildkit": true
  },
  "experimental": false,
  "debug": true,
  "registry-mirrors": [
      "https://gpdm9i3j.mirror.aliyuncs.com"
  ]
}
````

### Linux安装

推荐使用`Vagrant`和`VirtualBox`来生成虚拟机

#### Docker官方网站提供的Linux安装方式

本文中使用的镜像是Centos7，所以接下来的步骤是按照Centos7的步骤来的，至于其他的步骤请参照[官方文档](https://docs.docker.com/engine/install/centos/)

#### Linux环境下详细安装方式

##### 2.1安装yum-utils

`````shell
yum install -y yum-utils
`````

##### 2.2配置国内源

````sh
yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
````

##### 2.3解决problem with installed package podman-1.6.4-10.的报错

````shell
yum erase podman buildah
````

##### 2.4安装Docker

````shell
yum install -y docker-ce docker-ce-cli  containerd.io
````

##### 2.5查看Docker版本

````shell
# 简单信息
docker -v
# 查看docker的版本号，包括客户端、服务端、依赖的Go等
docker version
# 查看系统(docker)层面信息，包括管理的images, containers数等
docker info
````

##### 3.Docker服务相关

###### 3.1 启动

```shell
# 启动
systemctl start docker
# 开机自启
systemctl enable docker
```

###### 3.2 停止

```shell
systemctl stop docker
```

###### 3.3 重启

```shell
systemctl restart docker
```

###### 3.4 查看docker状态

```shell
systemctl status docker
```

## 三、Linux加速器配置

linux直接在`/etc/docker/daemon.json`中添加一段json段，如果没有这个文件夹或者这个文件直接创建即可，json内容如下：

````json
{
  "registry-mirrors": ["https://gpdm9i3j.mirror.aliyuncs.com"]
}
````

如果没有启动docker，可以执行`systemctl start docker`启动docker

倘若已经已启动可以通知systemd重载此配置文件

````shell
systemctl daemon-reload
````

然后重启docker服务

````shell
systemctl restart docker
````

如果想开机启动docker可以执行如下命令：

````shell
systemctl enable docker
````

这会儿再执行`docker --version`

```shell
[vagrant@localhost ~]$ docker --version
Docker version 20.10.14, build a224086
```

已成功安装

## 四、Docker其他配置

由于每次使用`vagrant`安装的虚拟机使用vagrant用户，使用Docker或者其他命令，都需要在命令前缀加上`sudo`，这儿方便以后使用，先把docker的命令全局化。

1. 想要去掉就必须让我们当前的用户有使用docker的权限

2. 执行groupadd命令

   ```shell
   [vagrant@localhost ~]$ sudo groupadd docker
   groupadd: group 'docker' already exists
   ```

3. docker这个group已经存在，那么我们将这个用户添加到docker这个group里面

   ```shell
   [vagrant@localhost ~]$ sudo gpasswd -a vagrant docker
   Adding user vagrant to group docker
   ```

   

4. 现在执行还是不行，我们要把docker进程重新启动一下，但是我还需要重新登录我们的shell才行。

   ````shell
   [vagrant@localhost ~]$ sudo service docker restart
   Redirecting to /bin/systemctl restart docker.service
   ````

   ```shell
   [vagrant@localhost ~]$ docker image ls
   Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get http://%2Fvar%2Frun%2Fdocker.sock/v1.24/images/json: dial unix /var/run/docker.sock: connect: permission denied
   ```

   还是会报错，需要重新登陆进shell

   ```shell
   litiandeMacBook-Pro:centos-7 litian$ vagrant ssh
   Last login: Sat May  8 08:40:03 2021 from 10.0.2.2
   [vagrant@localhost ~]$ docker version
   Client: Docker Engine - Community
    Version:           20.10.6
    API version:       1.41
    Go version:        go1.13.15
    Git commit:        370c289
    Built:             Fri Apr  9 22:45:33 2021
    OS/Arch:           linux/amd64
    Context:           default
    Experimental:      true
   
   Server: Docker Engine - Community
    Engine:
     Version:          20.10.6
     API version:      1.41 (minimum version 1.12)
     Go version:       go1.13.15
     Git commit:       8728dd2
     Built:            Fri Apr  9 22:43:57 2021
     OS/Arch:          linux/amd64
     Experimental:     false
    containerd:
     Version:          1.4.4
     GitCommit:        05f951a3781f4f2c1911b05e61c160e9c30eaa8e
    runc:
     Version:          1.0.0-rc93
     GitCommit:        12644e614e25b05da6fd08a38ffa0cfe1903fdec
    docker-init:
     Version:          0.19.0
     GitCommit:        de40ad0
   [vagrant@localhost ~]$ 
   ```

   