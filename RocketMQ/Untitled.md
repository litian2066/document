## `RocketMQ` - 整体介绍

+ `RocketMQ`是一款分布式、队列模型的消息中间件。

  有阿里巴巴最早开发，遵循并借鉴了JMS规范里的一些个MQ的实现，更参考了一些个优秀的中间件，更结合阿里自身双十一的业务需求，针对天猫双十一这些场景，实现了削峰填谷，分布式事务等优秀特性的开源框架。 

+ 最新版本：4.6.x版本

  3.x后闭源，后来进入到Apache进行孵化，到4.x版本，孵化成功，成为Apache的顶级项目。

+ 官网地址：`http://rocketmq.apache.org/`

+ 支持集群模型、负载均衡、水平扩展能力

  支持广播模型，是天然的集群。

+ 亿级别的消息堆积能力

  双十一已经看出来了。

+ 采用零拷贝的原理、顺序写盘、随机读

  后面会说

+ 丰富的API使用

  提供丰富的消息投递和拉取的API，提供同步的消息，在3.x之后又提供异步的消息，可见迭代很快，并且支持顺序消息、延迟消息、事务消息，基本上能想到的消息投递方式都有。在`RabbitMQ`里面，如果要保证同步异步消息的投递，可靠性的机制都还好说，但是要保证顺序消息包括事务消息就需要自己去实现了。这些API`RocketMQ`已经提供了。并且4.3版本之后事务消息也已经开源了。

+ 代码优秀，底层通信框架采用了`Netty NIO`框架

  性能比较好，基于Netty

+ `NameServer` 代替 `Zookeeper`

  在3.x的时候放弃了zk，在2.x的时候使用zk做消息的协调，在3.x的时候自己实现了一个nameserver，也就是自己造了一个轮子，去实现服务的协调以及寻址，那么为什么这么做呢？主要就是nameserver是更轻量级的应用。

+ 强调集群无单点，可扩展，任意一点高可用，水平可扩展

+ 消息失败重试机制、消息可查询

  类比`RabbitMQ`，消息如果消费失败，是不支持重新尝试的，只能自己手工的做一些重回队列呀什么的操作，或者自己重新发，或者是死信队列什么的。在`RocketMQ`中，如果消息发送失败了，Borker负责重发重试机制会有一个时间间隔， 每隔一定时间就重发，还可以带一个重试的次数，比如说定义重试十次依旧失败可以将其抛弃，这些都是能做到的。在消息可查询，相当于可以全面把控消息的进度和信息。顺便说一句，在3.x版本，放弃了RocketMQ Console控制台，取而代之是一个基于Spring Boot的控制台，可以更加方便我们去使用，不再需要tomcat容器。

+ 开源社区活跃、成熟度（经过双十一考验）

  `RocketMQ`本身团队迭代很快，在4.2.9之前，底层还采用了`nioBuffer`，后来换成了`NettyedBuffer`，可见其细节都在不停地做着优化，在4.3.0之后支持sql表达式的方式来消息过滤。说明`RocketMQ`在不停地进步，不停地在优化，是最值得学习的MQ，而其中的设计思路、机制、原理很值得我们学习。

## `RocketMQ`-核心概念模型

+ `Producer`：消息生产者，负责产生消息，一般由业务系统负责产生消息。

+ `Consumer`：消息消费者，负责消费消息，一般是后台系统负责异步消费。

+ `Push Consumer`：Consumer的一种，需要向Consumer对象注册监听。

  相当于在Consumer注册一个监听，监听MQ给我们推的消息

+ `Pull Consumer`：Consumer的一种，需要主动请求Broker拉取消息。

+ `Producer Group`：生产者集合，一般用于发送一类消息。

  也就是生产者可以有多个，在启动的时候定义多个节点为一组，那么有什么用呢？主要是做事务消息，消息回查 的时候需要用到生产者组。

+ `Consumer Group`：消费者集合，一般用于接收一类消息进行消费

  Group必须要定义，同样名字的Group只有一个。

+ `Broker`：MQ消息服务（中转角色，用于消息存储与生产消费转发）

## `RocketMQ`-源码包下载与结构说明

1. 克隆代码到本地

   ```
   git clone -b release-4.3.0 https://github.com/litian2066/rocketmq.git
   ```

   本文采用4.3.0的版本

2. 导入到idea里面

3. 编译

   ````
   mvn -Prelease-all -DskipTests clean install -U
   ````

4. 编译后了jar包在distribution子项目的target目录下，最后拿出来使用`java -jar`命令执行即可

5. 也可以解压cd后执行`nohup sh bin/mqnamesrv & `就行了

6. 

## `RocketMQ`-环境搭建

## `RocketMQ`-控制台部署与使用

